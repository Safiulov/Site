<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style_test.css">

  <title>Личный кабинет</title>
</head>

<body>
  <header>
    <a href="#" class="logo">Меню</a>
    <nav>
      <a href="#home">Главная</a>
      <a href="#about">Тарифы</a>
      <a href="#services">Услуги</a>
      <a href="#contact">Контакты</a>
      <a href="#reserve">Бронь</a>
      <a href="#" onclick="logout()">Выйти</a>
    </nav>
  </header>
  <main>
    <section id="home">
      <div class="card-container2">
        <div class="card2">
          <div class="front">
            <h2>Персональные данные</h2>
            <p> ФИО:<span id="Fio"></span> </p>
            <p> Email:<span id="Email"></span> </p>
            <p> Логин:<span id="Login"></span> </p>
          </div>
          <div class="back">
            <h1>Редактирование данных</h1>
            <form id="update-form">
              <label for="fio">ФИО:</label>
              <input type="text" id="fio" name="fio" value="" placeholder="example">
              <br>
              <label for="email">Электронная почта:</label>
              <input type="email" id="email" name="email" value="" placeholder="example@example.com">
              <br>
              <label for="login">Логин:</label>
              <input type="text" id="login" name="login" value="" placeholder="example">
              <br>
              <label for="password">Пароль:</label>
              <input type="password" id="password" name="password">
              <br>
              <button type="submit">Сохранить изменения</button>
            </form>
          </div>
          <div class="flip-icon" id="flip-btn">
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
        <div class="card2">
          <div class="front">
            <h2>Данные авто</h2>
            <p> Марка:<span id="Marka"></span> </p>
            <p> Цвет:<span id="Color"></span> </p>
            <p> Тип:<span id="Type"></span> </p>
            <p> Госномер:<span id="Number"></span> </p>
            <p> Год:<span id="Year"></span> </p>

          </div>
          <div class="back">
            <h1>Редактирование данных</h1>
            <form id="update-form2">
              <label for="marka">Марка:</label>
              <input type="text" id="marka" name="marka" value="" placeholder="example">
              <br>
              <label for="color">Цвет:</label>
              <input type="text" id="color" name="color" value="" placeholder="example@example.com">
              <br>
              <label for="type">Тип:</label>
              <input type="text" id="type" name="type" value="" placeholder="example">
              <br>
              <label for="number">Госномер:</label>
              <input type="text" id="number" name="number" value="" placeholder="example">
              <br>
              <label for="year">Год:</label>
              <input type="year" id="year" name="year" value="" placeholder="example">
              <br>
              <button type="submit">Сохранить изменения</button>
            </form>
          </div>



          <div class="flip-icon" id="flip-btn2">
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>

      </div>
    </section>

    <script>
      const updateForm = document.getElementById('update-form');

      updateForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const fio = document.getElementById('fio').value;
        const email = document.getElementById('email').value;
        const newLogin = document.getElementById('login').value;
        const newPassword = document.getElementById('password').value;
        const currentLogin = sessionStorage.getItem("Login");

        try {
          const response = await fetch('/update', {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              Логин: currentLogin, // замените на текущий логин пользователя
              ФИО: fio,
              Почта: email,
              НовыйЛогин: newLogin,
              НовыйПароль: newPassword,
            })
          });

          if (response.ok) {
            alert("OK");
            // Обновляем данные на странице
            document.getElementById("Fio").textContent = fio;
            document.getElementById("Email").textContent = email;
            document.getElementById("Login").textContent = newLogin;
          } else {
            throw new Error('Ошибка при обновлении');
          }
        } catch (error) {
          console.error(error);
          alert('Ошибка при обновлении');
        }
      });
    </script>

    <script>
      const updateForm2 = document.getElementById('update-form2');

      updateForm2.addEventListener('submit', async (event) => {
        event.preventDefault();

        const marka = document.getElementById('marka').value;
        const color = document.getElementById('color').value;
        const type = document.getElementById('type').value;
        const number = document.getElementById('number').value;
        const year = document.getElementById("year").value;
        const currentLogin = sessionStorage.getItem("Login");

        try {
          const response = await fetch('/update2', {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              // замените на текущий логин пользователя
              марка: marka,
              цвет: color,
              тип: type,
              госномер: number,
              год: year,

              Логин: currentLogin,
            })
          });

          if (response.ok) {
            alert("OK");
            // Обновляем данные на странице
            document.getElementById("Marka").textContent = marka;
            document.getElementById("Color").textContent = color;
            document.getElementById("Type").textContent = type;
            document.getElementById("Number").textContent = number;
            document.getElementById("Year").textContent = year;


          } else {
            throw new Error('Ошибка при обновлении');
          }
        } catch (error) {
          console.error(error);
          alert('Ошибка при обновлении');
        }
      });
    </script>






    <script>
      document.getElementById('flip-btn').addEventListener('click', function () {
        this.parentElement.classList.toggle('flip');
      });
      document.getElementById('flip-btn2').addEventListener('click', function () {
        this.parentElement.classList.toggle('flip');
      });
    </script>


    <section id="about">
      <h1>Тарифы</h1>
      <div class="card-container">
        <div class="card">
          <div class="front">
            <h2>Тариф "ДЕНЬ"</h2>
          </div>
          <div class="back">
            <h2>Описание</h2>
            <p>Парковка на период с 8:00 до 20:00</p>
            <p>Цена: 80 рублей/час</p>
          </div>
        </div>
        <div class="card">
          <div class="front">
            <h2>Тариф "НОЧЬ"</h2>
          </div>
          <div class="back">
            <h2>Описание</h2>
            <p>Парковка на период с 20:00 до 8:00</p>
            <p>Цена: 60 рублей/час</p>
          </div>
        </div>
        <div class="card">
          <div class="front">
            <h2>Тариф "СРЕДНИЙ"</h2>
          </div>
          <div class="back">
            <h2>Описание</h2>
            <p>Парковка на срок более 12, но не более 24 часов</p>
            <p>Цена: 65 рублей/час </p>
          </div>
        </div>
        <div class="card">
          <div class="front">
            <h2>Тариф "Круглый день"</h2>
          </div>
          <div class="back">
            <h2>Описание</h2>
            <p>Парковка на сутки и более...</p>
            <p>Цена: 1000 рублей/сутки </p>
          </div>
        </div>
        <div class="card">
          <div class="front">
            <h2>Тариф "СМЕШАННЫЙ"</h2>
          </div>
          <div class="back">
            <h2>Описание</h2>
            <p>До 20:00 оплата по тарифу "ДЕНЬ", после 20:00 оплата по тарифу "НОЧЬ"</p>
            <p>Цена: см.тарифы "ДЕНЬ" и "НОЧЬ" </p>
          </div>
        </div>
    </section>
    <section id="services">
      <h1>Наши услуги</h1>
      <div class="services-container">
        <div class="service-card" title="Тент-чехол для машины"
          style="background-image: url('https://vatanbranda.com/wp-content/uploads/2021/01/portatif-araba-cadiri.jpg');">
          <h2>Тент-чехол для машины на стоянке</h2>
          <p>Мы предлагаем услугу по защите автомобиля с помощью тент-чехлов на стоянке, которые будет защищать вашу
            машину от непогоды и механических повреждений.
            Тент-чехол будет идеально подходить для автомобилей, мотоциклов и других транспортных средств.</p>
        </div>
        <div class="service-card" title="Подкачка"
          style="background-image: url('https://img.freepik.com/free-photo/technician-is-inflate-car-tire-car-maintenance-service-transportation-safety_1150-18090.jpg?w=1380&t=st=1710355673~exp=1710356273~hmac=b17e04a2399e3b2d5bdce7606f5250dfae1f6143431baad2be162feafa83ff04');">
          <h2>Подкачка</h2>
          <p>Мы предлагаем услугу по подкачке шин на стоянке, которая будет помогать продлить срок службы ваших шин и
            обеспечить безопасность вождения.
            Подкачка шин будет проводиться с использованием современных станков и высококвалифицированных специалистов.
            Услуга подкачки шин будет подходить для автомобилей, мотоциклов и других транспортных средств</p>
        </div>
        <div class="service-card" title="Мойка"
          style="background-image: url('https://img.freepik.com/free-photo/beautiful-car-washing-service_23-2149212222.jpg?t=st=1710356117~exp=1710359717~hmac=d642b88ca1a0c7f459748d7e142aa7b7b759e19c790827ad7aa752aff3c98fa8&w=740');">
          <h2>Мойка</h2>
          <p>Мы предлагаем услугу полной мойки автомобиля, которая включает в себя тщательную очистку всех частей вашего
            автомобиля. Наша мойка включает в себя ручную очистку кузова, очистку колес, стекол и подножек. Мы
            используем только экологически чистые и безопасные для автомобиля средства. Полная мойка автомобиля поможет
            сохранить внешний вид вашего автомобиля и продлить срок его службы</p>
        </div>
      </div>
    </section>


    <section id="contact">

      <head>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.4.0/src/easy-button.css" />
        <script src="https://unpkg.com/leaflet-easybutton@2.4.0/src/easy-button.js"></script>
      </head>

      <body>
        <div id="map" style="width: 100%; height: 800px;margin-top: 60px;"></div>
        <script>
          var map = L.map('map').setView([54.286741, 48.233571], 15);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);

          var marker = L.marker([54.286741, 48.233571]).addTo(map)
            .bindPopup('<h2>CarPark</h2><p>Адрес: Баратаевский Аэропорт, Авиационная20</p><p>Телефон: +7 (920) 123-45-67</p><p>Email: carpark@example.com</p>');
          marker.openPopup();

          var focusMarkerButton = L.easyButton('fa-car', function () {
            map.setView(marker.getLatLng(), 18);
          });
          focusMarkerButton.addTo(map);

          var locateButton = L.easyButton('fa-location-arrow', function () {
            map.locate({ setView: true, maxZoom: 18 });
          });
          locateButton.addTo(map);

          var control = L.Routing.control({
            waypoints: [
              marker.getLatLng(),
              map.getCenter()
            ],
            routeWhileDragging: true
          });

          map.on('locationfound', function (e) {
            control.setWaypoints([e.latlng, marker.getLatLng()]);
            control.addTo(map);
          });

          map.on('locationerror', function (e) {
            alert("Не удалось определить ваше местоположение");
          });

          var clearRouteButton = L.easyButton('fa-times', function () {
            // Очищаем маршрут
            control.spliceWaypoints(0, control.getWaypoints().length);
          });

          clearRouteButton.addTo(map);

        </script>
      </body>
    </section>

    <section id="reserve">
      <body>
        <h1>Парковки:</h1>
        <form id="parking-form">
          <label for="service-select">Выберите услугу:</label>
          <select id="service-select" name="Тип_услуги" required>
            <option value="">Выберите услугу</option>
            <option value="1">Резервирование</option>
            <option value="2">Бронь на месяц</option>
            <option value="3">Бронь на год</option>
          </select>
          <label for="Место">Место:</label>
          <input type="text" id="место" name="Место" required>
          </select>
          <label for="date-input-1">Дата и время:</label>
          <input type="datetime-local" id="date-input-1" name="Дата_въезда" required>
          <button type="submit">Найти парковку</button>
          <div id="parking-status"></div>
        </form>
        <script src="script.js"></script>
      </body>
    </section>
    <script>
     document.addEventListener('DOMContentLoaded', () => {
  const parkingStatus = document.getElementById('parking-status');
  const textForm = document.getElementById('parking-form');
  const currentLogin = sessionStorage.getItem("Login");

  textForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const Место = document.getElementById('место').value;
    const Дата_въезда = document.getElementById('date-input-1').value;
    const Тип_услуги = document.getElementById('service-select').value;

    try {
      const response = await fetch('/parking-status2', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ Место, Дата_въезда, Логин: currentLogin, Тип_услуги }),
      });

      if (response.ok) {
        const data = await response.json();
        parkingStatus.textContent = data.message;
        alert("OK1");
      } else {
        const data = await response.json();
        parkingStatus.textContent = data.message;
        alert("NE OK!");
      }
    } catch (error) {
      console.error('Error:', error);
      parkingStatus.textContent = 'Ошибка при добавлении автомобиля на стоянку';
    }
  });

        fetch('/parking-status')
          .then((res) => res.json())
          .then((data) => {
            data.forEach((spot) => {
              const div = document.createElement('div');
              div.className = 'parking-spot';
              div.dataset.spotNumber = spot.Госномер;

              if (spot.Статус === 'Занято') {
                div.classList.add('occupied');
              } else if (spot.Статус === 'Свободно') {
                div.classList.add('free');
              }

              div.textContent = `${spot.Статус} ${spot.Место}`;

              parkingStatus.appendChild(div);
            });
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      });
    </script>



  </main>
  <script>
    let sections = document.querySelectorAll('section');
    let navLinks = document.querySelectorAll('header nav a');
    let currentSection = sections[0];
    let currentNavLink = document.querySelector('header nav a[href*=' + currentSection.getAttribute('id') + ']');
    currentNavLink.classList.add('active');
    window.onscroll = () => {
      sections.forEach(sec => {
        let top = window.scrollY;
        let offset = sec.offsetTop - 150;
        let height = sec.offsetHeight;
        let id = sec.getAttribute('id');
        if (top >= offset && top < offset + height) {
          navLinks.forEach(links => {
            links.classList.remove('active');
            document.querySelector('header nav a[href*=' + id + ']').classList.add('active');
          });
          document.title = document.querySelector('header nav a[href*=' + id + ']').textContent + ' - Личный кабинет';
        };
      });
    };
  </script>





  <script>
    const servicesContainer = document.querySelector('.services-container');
    let isMouseDown = false;
    let startX;
    let scrollLeft;
    servicesContainer.addEventListener('mousedown', (event) => {
      if (event.target.id === 'scroll-prev' || event.target.id === 'scroll-next') {
        return;
      }
      isMouseDown = true;
      startX = event.clientX;
      scrollLeft = servicesContainer.scrollLeft;
    });
    servicesContainer.addEventListener('mousemove', (event) => {
      if (!isMouseDown) {
        return;
      }
      const distanceX = event.clientX - startX;
      const newScrollLeft = scrollLeft - distanceX;
      servicesContainer.scrollTo({ left: newScrollLeft, behavior: 'instant' }); // Change 'smooth' to 'instant'
    });
    servicesContainer.addEventListener('mouseup', () => {
      isMouseDown = false;
    });
    servicesContainer.addEventListener('mouseleave', () => {
      isMouseDown = false;
    });
    document.querySelector('#scroll-prev').addEventListener('click', () => {
      servicesContainer.scrollTo({ left: servicesContainer.scrollLeft - servicesContainer.clientWidth, behavior: 'instant' }); // Change 'smooth' to 'instant'
    });
    document.querySelector('#scroll-next').addEventListener('click', () => {
      servicesContainer.scrollTo({ left: servicesContainer.scrollLeft + servicesContainer.clientWidth, behavior: 'instant' }); // Change 'smooth' to 'instant'
    });
  </script>


  <script>
    window.onload = () => {
      const Fio = sessionStorage.getItem("Fio");
      const Email = sessionStorage.getItem("Email");
      const Login = sessionStorage.getItem("Login");
      const Password = sessionStorage.getItem("Password");
      const Marka = sessionStorage.getItem("Marka");
      if (Marka) {
        document.getElementById("Marka").textContent = Marka;
      }
      const Color = sessionStorage.getItem("Color");
      if (Color) {
        document.getElementById("Color").textContent = Color;
      }
      const Type = sessionStorage.getItem("Type");
      if (Type) {
        document.getElementById("Type").textContent = Type;
      }
      const Number = sessionStorage.getItem("Number");
      if (Number) {
        document.getElementById("Number").textContent = Number;
      }
      const Year = sessionStorage.getItem("Year");
      if (Year) {
        document.getElementById("Year").textContent = Year;
      }
      if (Login && Password) {
        document.getElementById("Fio").textContent = Fio;
        document.getElementById("Email").textContent = Email;
        document.getElementById("Login").textContent = Login;
        document.getElementById("Password").textContent = Password;




      } else {
        document.getElementById("Fio").textContent = "Гость";
      }
    };
  </script>




  <script>
    function logout() {
      sessionStorage.clear();
      // Перенаправление на страницу авторизации
      window.location.href = "index.html";
    }
  </script>

</body>

</html>